window.baMet=function(){var C=function(o,e,a,n){var r="",i="";if(a){var s=new Date;s.setTime(s.getTime()+60*a*1e3),r="; expires="+s.toGMTString()}n&&(i="; domain="+n),document.cookie=o+"="+escape(e)+r+i+"; path=/"},c={urlPrefix:"",visitsUrl:window.Rivo.global_config.proxy_paths.app_metrics,baEvsUrl:window.Rivo.global_config.proxy_paths.app_metrics,page:null,useBeacon:!1,startOnReady:!0,applyVisits:!0,cookies:!0,cookieDomain:null,headers:{},visitParams:{},withCredentials:!1,pv:window.Rivo.global_config.pv,bam:window.Rivo.global_config.bam},t=window.baMet||{};t.configure=function(o){for(var e in o)o.hasOwnProperty(e)&&(c[e]=o[e])},t.configure(t);var y=!1,S=[],v=typeof JSON!="undefined"&&JSON.stringify!==void 0,g=[];function k(){return c.urlPrefix+c.baEvsUrl}function m(){for(var o;o=S.shift();)o();y=!0}function f(o){y?o():S.push(o)}t.setCookie=function(o,e,a){C(o,e,a,c.cookieDomain||c.domain)},t.getCookie=function(o){return function(e){var a,n,r=e+"=",i=document.cookie.split(";");for(a=0;a<i.length;a++){for(n=i[a];n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(r)===0)return unescape(n.substring(r.length,n.length))}return null}(o)},t.destroyCookie=function(o){C(o,"",-1)},t.log=function(o){t.getCookie("baMet_debug")&&window.console.log(o)};var p,I=["a","div"];function x(o,e){var a=o,n=a.matches||a.matchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector;if(n){if(n.apply(a,[e]))return a;if(!I.includes(a.tagName.toLowerCase())){for(;!I.includes(a.tagName.toLowerCase());)a=a.parentElement;return x(a,[e])}return!1}return t.log("Unable to match"),!1}function M(o,e){var a=[];for(l=0;l<e.items.length;l++){var n=e.items[l];a.push({id:n.id,properties:n.properties,quantity:n.quantity,variant_id:n.variant_id,product_id:n.product_id,final_price:n.final_price,image:n.image,handle:n.handle,title:n.title})}return{token:o,total_price:e.total_price,items:a,currency:e.currency}}function j(o){o._url.indexOf("/cart/add")>=0?t.getCartData(function(e){t.log(e),t.setCartAttributes(!0,e)}):t.setCartAttributes(!0,o.response)}function d(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(o){var e=16*Math.random()|0;return(o=="x"?e:3&e|8).toString(16)})+Math.floor(Date.now()).toString()}function O(){c.cookies&&v&&t.setCookie("baMet_baEvs",JSON.stringify(g),1)}function T(o){var e=o;return e.common=window.Rivo.common,delete e.common.product,e.api={},e}function A(o){f(function(){t.sendRequest(k(),T(o),function(){for(var e=0;e<g.length;e++)if(g[e].id==o.id){g.splice(e,1);break}O()})})}function R(o){var e,a;(c.useBeacon||c.applyNow)&&(a=c.headers,Object.keys(a).length===0)&&v&&window.navigator.sendBeacon!==void 0&&!c.withCredentials?(e=o,f(function(){var n,r=T(e),i=(n=document.querySelector("meta[name=csrf-param]"))&&n.content,s=function(){var u=document.querySelector("meta[name=csrf-token]");return u&&u.content}();i&&s&&(r[i]=s),window.navigator.sendBeacon(k(),JSON.stringify(r))})):(g.push(o),O(),setTimeout(function(){A(o)},1e3))}function D(){return window.location.pathname}function P(o){return o&&o.length>0?o:null}function E(o){var e=o.target;return function(a){for(var n in a)a.hasOwnProperty(n)&&a[n]===null&&delete a[n];return a}({tag:e.tagName.toLowerCase(),id:P(e.id),class:P(e.className),page:D()})}function N(){var o=new Date,e=o.toISOString().slice(0,10),a=t.getBrowserInfo(),n={shop_id:window.Rivo.common.shop.id,name:"create_visit",params:{landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,browser:a.browser,os:a.os,timezone:a.timezone},timestamp:parseInt(o.getTime()),date:e,hour:o.getUTCHours(),id:d(),visit_token:t.getVisitId(),visitor_token:t.getVisitorId(),app:"ba"};for(var r in document.referrer.length>0&&(n.referrer=document.referrer),c.visitParams)c.visitParams.hasOwnProperty(r)&&(n[r]=c.visitParams[r]);t.log(n),c.bam||R(n)}function L(){var o=function(){var a=t.getVisitId(),n=t.getVisitorId()&&!a;t.log("current visit_token"),t.log(a);var r=new Date,i=new Date;i.setUTCHours(23,59,59,59);var s=(i-r)/1e3,u=s/60;return(u>30||s<2)&&(u=30),!a||s<2?(a=d(),t.setCookie("baMet_visit",a,u),n&&N()):t.setCookie("baMet_visit",a,u),a}(),e=t.getVisitorId();c.cookies===!1||c.applyVisits===!1?(t.log("Visit applying disabled"),m()):o&&e?(t.log("Active visit"),m()):t.getCookie("baMet_visit")?(t.log("Visit started"),e||(e=d(),localStorage.setItem("baMet_visitor",e)),N(),m()):(t.log("baCookies disabled"),m())}t.onBaEv=function(o,e,a){document.addEventListener(o,function(n){var r=x(n.target,e);r&&a({target:r})})},t.sendRequest=function(o,e,a){fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(n){console.log(n),a(n)}).catch(function(n){console.log(n)})},t.getCartData=function(o){fetch("/cart.js?ba_request=1",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){e.status===200?e.json().then(function(a){o(a)}):console.log("Looks like there was a problem. Status Code: "+e.status)}).catch(function(e){console.log(e)})},t.syncCsId=function(){var o=t.getCookie("baMet_cs_id");return o||(o=d()),t.setCookie("baMet_cs_id",o,20160),o},t.getVisitId=t.getVisitToken=function(){return t.getCookie("baMet_visit")},t.getVisitorId=t.getVisitorToken=function(){return localStorage.getItem("baMet_visitor")},t.getCustomerId=function(){return localStorage.getItem("baMet_customer_id")},t.isAdmin=function(){return t.getCookie("ba_admin")},t.reset=function(){return t.destroyCookie("baMet_visit"),localStorage.removeItem("baMet_visitor"),t.destroyCookie("baMet_baEvs"),t.destroyCookie("baMet_apply"),!0},t.debug=function(o){return o===!1?t.destroyCookie("baMet_debug"):t.setCookie("baMet_debug","t",525600),!0},t.getBrowserInfo=function(){var o={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Android",value:"Android",version:"Android"},{name:"Mac OS",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var e=this.header.join(" "),a=this.matchItem(e,this.dataos),n=this.matchItem(e,this.databrowser),r=new Date().getTimezoneOffset()/60;return timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,{os:a,browser:n,tz_offset:r,timezone:timezone}},matchItem:function(e,a){var n,r,i=0,s=0;for(i=0;i<a.length;i+=1)if(new RegExp(a[i].value,"i").test(e)){if(n=new RegExp(a[i].version+"[- /:;]([\\d._]+)","i"),(r=e.match(n))&&r[1]&&(r=r[1]),r)for(r=r.split(/[._]+/),s=0;s<r.length;s+=1)r[s];return a[i].name}return"Unknown"}};return o.init()},t.register=function(o,e,a){try{var n=new Date,r=n.toISOString().slice(0,10),i={shop_id:window.Rivo.common.shop.id,name:o,params:e||{},timestamp:parseInt(n.getTime()),date:r,hour:n.getUTCHours(),id:d(),app:a};f(function(){c.cookies&&!t.getVisitId()&&L(),f(function(){t.log(i),i.visit_token=t.getVisitId(),i.visitor_token=t.getVisitorId(),R(i)})})}catch(s){t.log(s),t.log("error applying")}return!0},t.registerAppClicks=function(){t.onBaEv("click",".ba-met-handler",function(o){try{var e=o.target,a=e.getAttribute("data-ba-met-name");if(a){var n=E(o),r=e.getAttribute("data-ba-met-app");if(n.text=n.tag=="input"?e.value:(e.textContent||e.innerText||e.innerHTML).replace(/[\s\r\n]+/g," ").trim(),n.href=e.href,i=e.getAttribute("data-ba-met-extras")){var i=cleanNumbers(JSON.parse(i));for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])}t.register(a,n,r)}}catch(u){t.log("applyAppClicks exception"),t.log(u)}})},t.registerAtc=function(){t.onBaEv("click",".product-form__cart-submit, #AddToCart-product-template, .product-atc-btn, .product-menu-button.product-menu-button-atc, .button-cart, .product-add, .add-to-cart input, .btn-addtocart, [name=add]",function(o){Date.now();var e=o.target,a=E(o);a.text=a.tag=="input"?e.value:(e.textContent||e.innerText||e.innerHTML).replace(/[\s\r\n]+/g," ").trim(),a.href=e.href,t.register("atc",a,"ba")})},t.saveBaCartData=function(o){if(v){var e=t.getBaCartData();e.push(o),localStorage.setItem("baMet_cartData",JSON.stringify(e))}},t.getBaCartData=function(){try{if(localStorage.getItem("baMet_cartData")){var o=parseInt(new Date().getTime())-2592e5,e=JSON.parse(localStorage.getItem("baMet_cartData")).filter(function(a){return parseInt(a.ts)>o}).reverse();return localStorage.setItem("baMet_cartData",JSON.stringify(e)),e}return[]}catch(a){t.log(a),t.log("error getting ba")}},t.updateBaCart=function(o){t.log("checking if cart is out of sync with db");var e=t.getCookie("cart"),a=t.getCookie("ba_cart_token"),n=localStorage.getItem("baMet_latest_cart"),r=localStorage.getItem("baMsg_synced_cart");(o||n!=r||e!=a)!=0?(t.setCookie("ba_cart_token",e,2880),c.bam||t.register("update_cart_db",{},"ba"),localStorage.setItem("baMsg_synced_cart",n),t.log("cart token changed -posting to the API from here")):t.log("cart is in sync with db")},t.setCartAttributes=function(o,e){try{if(t.log("setting cart attributes"),typeof e=="string")var a=JSON.parse(e);else a=e;var n=t.getCookie("cart"),r=localStorage.getItem("baMet_latest_cart");if(!n&&!r)return;if(o){t.log("set cart attributes identified ajax cart update"),t.log(a);var i=M(n,a);window.Rivo.common.cart=i}else B=n,window.Rivo.common.cart=M(B,window.Rivo.common.cart),i=window.Rivo.common.cart;localStorage.setItem("baMet_latest_cart",JSON.stringify(i));var s=i.items,u=t.getBaCartData();if(u.length>0){var h={visit_token:t.getVisitId(),visitor_token:t.getVisitorToken(),items:[],cart_token:n};for(l=0;l<s.length;l++){var b=s[l];if(b){var _=u.find(function(w){return w.id==b.id});_&&(b.ba_conversion_data=_,h.items.push(_),window.Rivo.common.has_ba_conversion=!0)}}var V=JSON.stringify(h)}var J=localStorage.getItem("ba_conversion_data");window.Rivo.common.ba_conversion_data=h,J!=V||window.Rivo.common.ba_conversion_data&&window.Rivo.common.template=="cart"?(t.log("saving ba_conversion_data"),localStorage.setItem("ba_conversion_data",V),t.updateBaCart(!0)):t.updateBaCart(!1)}catch(w){t.log("setCartAttributes exception"),t.log(w)}var B},t.registerAll=function(){document.referrer.indexOf("/admin/shops/")>0&&t.setCookie("ba_admin",1,1051200),t.setCartAttributes(!1,{}),t.registerAppClicks()};try{g=JSON.parse(t.getCookie("baMet_baEvs")||"[]")}catch(o){}for(var l=0;l<g.length;l++)A(g[l]);return function(){t.log("awaiting ajax cart update");try{var o=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.addEventListener("load",function(){this._url&&this._url.search(/cart.*js/)>=0&&this._method!="GET"&&(t.log("its a cart endpoint thats not a get request"),j(this))}),o.apply(this,arguments)}}catch(e){t.log(e),t.log("error catching ajax cart")}}(),function(){t.log("awaiting cart fetch update");try{var o=fetch;fetch=function(e,a){var n=!1;e&&typeof e.search=="function"&&e.search(/cart.*js|cart\/add|cart\/change/)>=0&&e.search("ba_request")<0&&a&&(a.method=="POST"||a.method=="PUT")&&(console.log("caught a fetch cart event",e,a),n=!0);var r=o(e,a);return r.then(function(i){n&&t.getCartData(function(s){t.setCartAttributes(!0,s)})}),r}}catch(e){t.log(e),t.log("error catching cart fetch")}}(),t.start=function(){var o;c.bam&&t.log("SESSIONS ARE RATE LIMITED - THE APP WILL NOT WORK UNTIL 00:00 UTC"),L(),t.start=function(){},c.page_views&&(o=t.page_hash,t.register("page_view",o,"ba")),window.Rivo.common.customer&&!t.getCustomerId()&&(t.register("sync_customer",{},"ba"),localStorage.setItem("baMet_customer_id",window.Rivo.common.customer.id))},p=function(){c.startOnReady&&t.start()},document.readyState==="interactive"||document.readyState==="complete"?p():document.addEventListener("DOMContentLoaded",p),t.page_hash={url:window.location.href,page:D(),template:window.Rivo.common.template},t.registerAll(),t}();//!
//# sourceMappingURL=/s/files/1/0194/1736/6592/t/1/assets/ba_tracking.js.map?v=1671714963
